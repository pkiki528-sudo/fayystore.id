<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ketentuan Garansi - FAYYSTORE</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <!-- background blur blobs (samakan dengan halaman lain) -->
  <div class="blob b1"></div>
  <div class="blob b2"></div>
  <div class="blob b3"></div>

  <main class="wrap">
    <section class="card warranty-card">
      <h1 class="title">Syarat &amp; Ketentuan di FAYYSTORE</h1>
      <p class="sub">Pilih produk untuk melihat detail ketentuan dan garansi yang berlaku.</p>

      <div class="warranty-top">
        <div class="select-wrap">
          <label for="produk" class="label">Pilih Produk</label>

          <!-- IMPORTANT: option produk akan diisi otomatis dari Sheet -->
          <select id="produk" class="select" disabled>
            <option value="">Memuat produk...</option>
          </select>
        </div>

        <a class="btn-back" href="index.html">← back</a>
      </div>

      <div id="detail" class="detail">
        <p class="muted">Silakan pilih produk untuk menampilkan ketentuan garansi.</p>
      </div>
    </section>
  </main>

  <script>
    // =========================
    // 1) GANTI URL DI SINI
    // =========================
    const SHEET_API_URL = "https://script.google.com/macros/s/AKfycbz6zGN9ZNLCt8Fdmet2C19KRcaiT5x3jvki6z-OdY4T83ucmjEWFgBHhadD0dlB-MUW5Q/exec";

    // Ambil elemen
    const selectEl = document.getElementById("produk");
    const detailEl = document.getElementById("detail");

    let data = {}; // format: { "Canva Pro": { deskripsi:[], garansi:[] }, ... }

    function escapeHtml(str) {
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function setLoading(isLoading, msg = "Memuat data garansi...") {
      if (isLoading) {
        selectEl.disabled = true;
        detailEl.innerHTML = `<p class="muted">${escapeHtml(msg)}</p>`;
      } else {
        selectEl.disabled = false;
      }
    }

    function render(val) {
      if (!val || !data[val]) {
        detailEl.innerHTML =
          `<p class="muted">Silakan pilih produk untuk menampilkan ketentuan garansi.</p>`;
        return;
      }

      const item = data[val] || {};
      const deskripsi = Array.isArray(item.deskripsi) ? item.deskripsi : [];
      const garansi = Array.isArray(item.garansi) ? item.garansi : [];

      detailEl.innerHTML = `
        <h3>${escapeHtml(val)}</h3>

        <h3>Deskripsi</h3>
        ${deskripsi.length
          ? `<ul>${deskripsi.map(x => `<li>${escapeHtml(x)}</li>`).join("")}</ul>`
          : `<p class="muted">Tidak ada deskripsi.</p>`}

        <h3>Ketentuan Garansi</h3>
        ${garansi.length
          ? `<ul>${garansi.map(x => `<li>${escapeHtml(x)}</li>`).join("")}</ul>`
          : `<p class="muted">Tidak ada ketentuan garansi.</p>`}
      `;
    }

    function fillSelect() {
      selectEl.innerHTML = `<option value="">-- Silakan Pilih Produk --</option>`;

      Object.keys(data)
        .sort((a, b) => a.localeCompare(b))
        .forEach((name) => {
          const opt = document.createElement("option");
          opt.value = name;
          opt.textContent = name;
          selectEl.appendChild(opt);
        });
    }

    async function loadFromSheet() {
      setLoading(true);

      try {
        const res = await fetch(SHEET_API_URL, { cache: "no-store" });
        const text = await res.text();

        // Kadang Apps Script ngasih HTML error → biar gampang kebaca
        // Kalau bukan JSON, JSON.parse akan gagal dan masuk catch
        const json = JSON.parse(text);

        // Kalau script kamu ngembaliin {error: "..."}:
        if (json && json.error) {
          detailEl.innerHTML = `<p class="muted">${escapeHtml(json.error)}</p>`;
          selectEl.innerHTML = `<option value="">-- Gagal memuat produk --</option>`;
          return;
        }

        data = json || {};

        fillSelect();
        setLoading(false);

        // Auto render jika sebelumnya ada pilihan tersimpan (optional)
        render(selectEl.value);
      } catch (err) {
        console.error("GARANSI LOAD ERROR:", err);
        selectEl.disabled = true;
        selectEl.innerHTML = `<option value="">-- Error memuat produk --</option>`;
        detailEl.innerHTML =
          `<p class="muted">Gagal memuat data. Pastikan URL /exec benar & akses Web App = "Siapa saja".</p>`;
      }
    }

    // Event
    selectEl.addEventListener("change", () => {
      render(selectEl.value);
    });

    // Jalankan setelah DOM siap
    window.addEventListener("DOMContentLoaded", () => {
      // Validasi URL supaya gak bingung kalau lupa paste
      if (!SHEET_API_URL || SHEET_API_URL.includes("PASTE_URL")) {
        selectEl.disabled = true;
        selectEl.innerHTML = `<option value="">-- Tempel URL /exec dulu --</option>`;
        detailEl.innerHTML =
          `<p class="muted">Belum ada URL API. Edit <code>SHEET_API_URL</code> lalu paste URL Web App (/exec).</p>`;
        return;
      }

      loadFromSheet();
    });
  </script>
</body>
</html>
